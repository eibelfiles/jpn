/*! Japanisu.main - v1.0.4 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).whale=e()}(this,(function(){"use strict";function t(t,e,i){return t.addEventListener(e,i),()=>{t.removeEventListener(e,i)}}function e({dataset:t}){const e={};return Object.keys(t).forEach((i=>{var s;e[i]="true"===(s=t[i])||"false"!==s&&(+s+""===s?+s:"null"===s||""===s?null:s)})),e}function i(t,e){let i=0;if("object"==typeof(s=t)&&"number"==typeof s.length){const s=t.length;for(;i<s&&!1!==e.call(t[i],t[i],i);i++);}else for(i in t)if(!1===e.call(t[i],t[i],i))break;var s;return t}function s(t){return function(e,s){e.length||(e=[e]),i(e,(function(e){e.classList[t](s)}))}}function n(t,e){return t.classList.contains(e)}const o=s("add"),c=s("remove"),l=s("toggle");const a={start:1,time:10};const r="is-active";const d={width:600,height:400};class h{constructor(i,s={}){this.element=i,this.config={...d,...s,...e(i)},t(i,"click",this.handleClick.bind(this))}handleClick(t){t.preventDefault();const e=this.config.width,i=this.config.height,s="top="+(window.screen.height-i)/2+", left="+(window.screen.width-e)/2+", width="+e+", height="+i;window.open(this.element.href,"",s)}}const u={outside:!1},f="is-active";const g={class:"is-active"};const m="--ws-offset-scroll",v="is-active",p="modal-is-open";const w="is-active";const y={Tab:function(e){let s;i(e.querySelectorAll("[data-target]"),(e=>{const i=document.getElementById(e.dataset.target);n(e,r)&&(s=[e,i],o(i,r)),t(e,"click",(()=>{const t=[e,i];s&&c(s,r),s=t,o(s,r)}))}))},Counter:class{constructor(i){this.config={...a,...e(i)},this.element=i,this.count=this.config.start,this.active=!1,this.setContent(this.count++),this.unsubscribe=t(window,"scroll",this.handleScroll.bind(this)),this.handleScroll()}handleScroll(){(function(t){const e=t.offsetTop,i=e+t.offsetHeight,s=window.pageYOffset,n=s+window.innerHeight;return i>=s&&e<=n&&i<=n&&e>=s})(this.element)&&(this.interval=setInterval(this.showCounter.bind(this),this.config.time),this.unsubscribe())}setContent(t){this.element.textContent=t}showCounter(){this.setContent(this.count),this.count++>=this.config.end&&clearInterval(this.interval)}},Window:h,Windows:function(t){const i=Array.from(t.querySelectorAll("a")),s=e(t);i.forEach((t=>{new h(t,s)}))},Navbar:class{constructor(t){this.element=t,this.init()}init(){this.translateY=0,this.updateValues(),window.addEventListener("resize",function(){this.updateValues(),this.handleScroll()}.bind(this)),window.addEventListener("scroll",this.handleScroll.bind(this))}updateValues(){this.scrollTop=window.pageYOffset,this.offsetHeight=this.element.offsetHeight}handleScroll(){const t=this.element,e=this.offsetHeight,i=window.pageYOffset,s=i-this.scrollTop;let n=this.translateY+s;t.classList[Math.abs(s)>=e?"add":"remove"]("exced-scroll"),n>=e?n=e:n<=0&&(n=0),t.style.transform="translateY("+n/e*-100+"%)",this.translateY=n,this.scrollTop=i}},Accordion:class{constructor(t){this.element=t,this.active=!1;const i=t.querySelectorAll("[data-toggle]");this.config={...u,...e(t)},i&&(this.titles=i,this.init())}init(){i(this.titles,(t=>{const e=t.parentNode,i=e.parentNode.querySelectorAll("[data-item]");t.addEventListener("click",(t=>{t.preventDefault();const s=this.config.outside?e=>{t===e||this.element.contains(e.target)||i.length&&(c(i,f),this.active=!1)}:()=>{};this.active||(document.addEventListener("click",s),this.active=!0),n(e,f)?c(e,f):(i.length&&c(i,f),o(e,f))}))}))}},Outside:class{constructor(t){this.element=t;const i=e(t);this.config={...g,...i},this.target=i.target?document.getElementById(i.target):this.element,this.init()}init(){this.element.addEventListener("click",this.handleClick.bind(this))}handleClick(t){const e=this.element,i=this.target,s=this.config.class;n(i,s)?c([e,i],s):(o([e,i],s),document.addEventListener("click",(function n(o){o===t||o.target===i||i.contains(o.target)||(c([e,i],s),document.removeEventListener("click",n))})))}},Watch:function(t){!function(t,e){new window.IntersectionObserver((function(t){t.forEach((t=>{t.isIntersecting&&t.target.classList.add(e)}))}),{threshold:1}).observe(t)}(t,{class:"is-visible",...e(t)}.class)},Modal:class{constructor(t){const e=t.getAttribute("data-target");e&&(this.target=document.querySelector(e),this.dialog=this.target.querySelector("[data-dialog]"),this.element=t,this.close=document.querySelectorAll("[data-close]"),this.init())}init(){this.element.addEventListener("click",this.show.bind(this)),this.target.addEventListener("click",(t=>{this.dialog.contains(t.target)||this.hide()})),i(this.close,(t=>{t.addEventListener("click",this.hide.bind(this))}))}hide(){const t=function(t){if(!t)return 0;const e=window.getComputedStyle(t),i=e.transitionDuration,s=e.transitionDelay;return parseFloat(i)||parseFloat(s)?1e3*(parseFloat(s.split(",")[0])+parseFloat(i.split(",")[0])):0}(this.target)+5;this.escape&&(this.escape(),this.escape=null),this.target.classList.remove(v),setTimeout((()=>{document.body.classList.remove(p),document.body.style.removeProperty(m),document.body.style.paddingRight="",document.body.style.overflow=""}),t)}show(){const t=function(){const t=document.createElement("div");t.classList.add("modal-scrollbar-measure"),document.body.appendChild(t);const e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e}()+"px";var e,i,s;document.body.classList.add(p),document.body.style.setProperty(m,t),document.body.style.paddingRight=t,document.body.style.overflow="hidden",this.target.classList.add(v),this.escape=(e=window,i="keydown",s=t=>{"Escape"===t.key&&this.hide()},void e.addEventListener(i,(function t(n){s(n),e.removeEventListener(i,t)})))}},Group:class{constructor(t){const e=t.getAttribute("data-target"),i=document.querySelectorAll(e);this.prev=null,i&&(this.targets=i,this.elements=t.querySelectorAll("[data-class]"),this.init())}init(){i(this.elements,(t=>{const e=t.getAttribute("data-class");t.addEventListener("click",(t=>{this.handleClick(t,e)}))}))}handleClick(t,e){t.preventDefault();const i=this.targets,s=t.target,n=this.prev;n&&(c(i,n.previous),c(n.el,"is-active")),o(i,e),o(s,"is-active"),this.prev={previous:e,el:s}}},Dropdown:function(t){t.addEventListener("click",(e=>{const i=t.parentNode;n(i,w)?c([t,i],w):(o([t,i],w),document.addEventListener("click",(function s(n){n===e||n.target===i||i.contains(n.target)||(c([t,i],w),document.removeEventListener("click",s))})))}))}};return i({add:o,remove:c,toggle:l},((t,e)=>{y[e]=function(e){const i=e.getAttribute("data-target"),s=e.getAttribute("data-class")||"is-active",n=i?document.querySelectorAll(i):[e];n&&s&&e.addEventListener("click",(()=>{t(n,s)}))}})),i(y,((t,e)=>{const s=e.toLowerCase();i(document.querySelectorAll(`[data-wjs="${s}"]`),(e=>{new t(e)}))})),y}));
function $$(e){return document.getElementById(e)}function $(e,t){return(t||document).querySelector(e)}function toSeconds(e){var t=e.split(":");return 60*+t[0]*60+60*+t[1]}function getTrackPosition(e,t){return(toSeconds(e)-toSeconds(t))/16+48}function setAccentColor(e,t){let n=new ColorThief;t.complete?e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`):t.addEventListener("load",function(){e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`)})}function setScrollText(){document.querySelectorAll(".player-meta").forEach(e=>{var t=$(".song-title",e),n=t.offsetWidth,s=e.offsetWidth;e.setAttribute("style","--title-width:"+s+"px"),n>s?t.classList.add("song-very-long"):t.classList.remove("song-very-long")})}const DATE_UNITS={day:86400,hour:3600,minute:60,second:1},getSecondsDiff=e=>(Date.now()-e)/1e3,getUnitAndValueDate=e=>{for(const[t,n]of Object.entries(DATE_UNITS))if(e>=n||"second"===t){return{value:-1*Math.floor(e/n),unit:t}}},getTimeAgo=e=>{const t=new Intl.RelativeTimeFormat,n=getSecondsDiff(e),{value:s,unit:o}=getUnitAndValueDate(n);return t.format(s,o)};function createUpcoming(e){var t="";for(const n of e)t+=`\n      <div class="upcoming bg-dark shadow-xl" data-start="${n.start}" data-end="${n.end}">\n        <img class="upcoming-image fit-image" src="${n.poster}" alt="${n.title}">\n        <div class="upcoming-data fs-7 relative py-.75 px-1.25">\n          <div class="upcoming-title fw-500 color-title nowrap">${n.title}</div>\n          <div class="upcoming-time">${n.start} - ${n.end}</div>\n        </div>\n      </div>\n    `;return t}const upcoming=$$("renderUpcoming");function createHistory(e,t){let n="";for(const s of e.slice(0,t)){let e=s.played_at,t=new Date(1e3*e);n+=`\n      <div class="history-item relative">\n        <img oncontextmenu="return false;" class="events-none history-image bg-dark flex-none rounded-.5 shadow-m mr-1" src="${s.song.art}" alt="${s.song.text}" width="120" height="120">\n        <div class="history-meta flex-1">\n          <h3 class="fs-6 fw-500 color-title">${s.song.title}</h3>\n          <div class="fs-7 opacity-.75">${s.song.artist}</div>\n          <div class="fs-7 opacity-.75">${getTimeAgo(t)}</div>\n        </div>\n      </div>\n    `}return n}function setPlayerMeta(e,t){let n=$(".song-cover",e),s=$(".song-title",e),o=$(".song-artist",e),a=$(".song-album",e);n&&(n.src=t.art),s&&(s.innerText=t.title),o&&(o.innerText=t.artist),a&&(a.innerText=t.album)}upcoming&&(upcoming.innerHTML=createUpcoming(currentSchedule));const player=$(".player"),audioPlayer=$(".player-audio");if(audioPlayer&&audioPlayer.dataset.src){const e=new Audio(audioPlayer.dataset.src),t=$(".player-volume",audioPlayer);t.addEventListener("change",function(t){e.volume=t.currentTarget.value/100,localStorage.setItem("player_vol",e.volume)},!1);var getVolume=localStorage.getItem("player_vol");getVolume&&(e.volume=getVolume,t.value=100*getVolume);var playBtn=$(".player-toggle",audioPlayer),playIcon=$(".i-play",audioPlayer),pauseIcon=$(".i-pause",audioPlayer);playBtn.addEventListener("click",()=>{e.paused?(e.load(),player.classList.toggle("is-playing"),e.play(),playBtn.innerHTML='<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>'):(player.classList.toggle("is-playing"),e.pause(),playBtn.innerHTML='<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>')},!1)}const japanisu="https://stream.radioani.me/api/nowplaying_static/japanisu.json";function playerInit(){fetch(japanisu).then(e=>e.json()).then(e=>{let t=e.song_history,n=$$("playerHistory"),s=$(".song-now",player),o=$(".song-next",player),a=e.now_playing.remaining,i=$(".player-poster");i&&i.src&&(i.crossOrigin="Anonymous",i.src="https://images.weserv.nl/?url="+encodeURIComponent(e.now_playing.song.art),setAccentColor(document.body,i)),s&&setPlayerMeta(s,e.now_playing.song),o&&setPlayerMeta(o,e.playing_next.song),n&&(n.innerHTML=createHistory(t,n.dataset.results||5)),setScrollText(),setTimeout(playerInit,1e3*a)}).catch(e=>console.log(e))}playerInit();const listeners=$$("listeners");function getListeners(){fetch(japanisu).then(e=>e.json()).then(e=>{let t=e.listeners.current;listeners.innerText=t,setTimeout(getListeners,1e3*(listeners.dataset.update||5))}).catch(e=>console.log(e))}listeners&&getListeners();const program=$$("program");function setProgramStatus(){let e=new Date,t=e.toLocaleTimeString([],{timeStyle:"short"}),n=e.toLocaleString("es",{weekday:"long"}),s=program.querySelectorAll(".program-item"),o=toSeconds(t);s.forEach(e=>{if(e.dataset.week==n){e.querySelectorAll(".upcoming").forEach(e=>{let t=toSeconds(e.dataset.start),n=toSeconds(e.dataset.end);t<=o&&n>o?e.classList.add("is-online"):e.classList.remove("is-online")})}})}program&&(setProgramStatus(),setInterval(setProgramStatus,1e4));const programming=$$("renderUpcoming");function setTimePosition(){let e=(new Date).toLocaleTimeString([],{timeStyle:"short"});programming.querySelectorAll(".upcoming").forEach(t=>{let n=getTrackPosition(t.dataset.start,e);t.setAttribute("style",`transform: translateX(${n}px)`),t.classList.add("is-loaded")})}programming&&(setTimePosition(),setInterval(setTimePosition,6e4));const stickyHeader=document.querySelector(".header-player");function sticky(){if(stickyHeader){var e=stickyHeader.offsetHeight;window.addEventListener("scroll",function(){window.scrollY>stickyHeader.offsetTop+e?(stickyHeader.nextElementSibling.setAttribute("style","margin-top:"+e+"px"),stickyHeader.classList.add("header-sticky","fixed","z-100","t-0","x-0")):(stickyHeader.classList.remove("header-sticky","fixed","z-100","t-0","x-0"),stickyHeader.nextElementSibling.removeAttribute("style"))})}}window.innerWidth>760&&sticky();