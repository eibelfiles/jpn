//! Japanisu v9.5
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).whale=e()}(this,(function(){"use strict";function t({dataset:t}){const e={};return Object.keys(t).forEach((n=>{var s;e[n]="true"===(s=t[n])||"false"!==s&&(+s+""===s?+s:"null"===s||""===s?null:s)})),e}function e(t,e){let n=0;if("object"==typeof(s=t)&&"number"==typeof s.length){const s=t.length;for(;n<s&&!1!==e.call(t[n],t[n],n);n++);}else for(n in t)if(!1===e.call(t[n],t[n],n))break;var s;return t}function n(t){return function(n,s){n.length||(n=[n]),e(n,(function(e){e.classList[t](s)}))}}function s(t,e){return t.classList.contains(e)}const i=n("add"),a=n("remove"),o=n("toggle"),r="is-active",c={outside:!1},l="is-active",d={class:"is-active"},u="--ws-offset-scroll",m="is-active",g="modal-is-open",v="is-active",h={Tab:function(t){let n;e(t.querySelectorAll("[data-target]"),(t=>{const e=document.getElementById(t.dataset.target);s(t,r)&&(n=[t,e],i(e,r)),function(t,e,n){t.addEventListener("click",n)}(t,0,(()=>{const s=[t,e];n&&a(n,r),n=s,i(n,r)}))}))},Accordion:class{constructor(e){this.element=e,this.active=!1;const n=e.querySelectorAll("[data-toggle]");this.config={...c,...t(e)},n&&(this.titles=n,this.init())}init(){e(this.titles,(t=>{const e=t.parentNode,n=e.parentNode.querySelectorAll("[data-item]");t.addEventListener("click",(t=>{const o=this.config.outside?e=>{t===e||this.element.contains(e.target)||n.length&&(a(n,l),this.active=!1)}:()=>{};this.active||(document.addEventListener("click",o),this.active=!0),s(e,l)?a(e,l):(n.length&&a(n,l),i(e,l))}))}))}},Outside:class{constructor(e){this.element=e;const n=t(e);this.config={...d,...n},this.target=n.target?document.getElementById(n.target):this.element,this.init()}init(){this.element.addEventListener("click",this.handleClick.bind(this))}handleClick(t){const e=this.element,n=this.target,o=this.config.class;s(n,o)?a([e,n],o):(i([e,n],o),document.addEventListener("click",(function s(i){i===t||i.target===n||n.contains(i.target)||(a([e,n],o),document.removeEventListener("click",s))})))}},Watch:function(e){!function(t,e){new window.IntersectionObserver((function(t){t.forEach((t=>{t.isIntersecting&&t.target.classList.add(e)}))}),{threshold:1}).observe(t)}(e,{class:"is-visible",...t(e)}.class)},Modal:class{constructor(t){const e=t.getAttribute("data-target");e&&(this.target=document.querySelector(e),this.dialog=this.target.querySelector("[data-dialog]"),this.element=t,this.close=document.querySelectorAll("[data-close]"),this.init())}init(){this.element.addEventListener("click",this.show.bind(this)),this.target.addEventListener("click",(t=>{this.dialog.contains(t.target)||this.hide()})),e(this.close,(t=>{t.addEventListener("click",this.hide.bind(this))}))}hide(){const t=function(t){if(!t)return 0;const e=window.getComputedStyle(t),n=e.transitionDuration,s=e.transitionDelay;return parseFloat(n)||parseFloat(s)?1e3*(parseFloat(s.split(",")[0])+parseFloat(n.split(",")[0])):0}(this.target)+5;this.escape&&(this.escape(),this.escape=null),this.target.classList.remove(m),setTimeout((()=>{document.body.classList.remove(g),document.body.style.removeProperty(u),document.body.style.paddingRight="",document.body.style.overflow=""}),t)}show(){const t=function(){const t=document.createElement("div");t.classList.add("modal-scrollbar-measure"),document.body.appendChild(t);const e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e}()+"px";var e,n,s;document.body.classList.add(g),document.body.style.setProperty(u,t),document.body.style.paddingRight=t,document.body.style.overflow="hidden",this.target.classList.add(m),this.escape=(e=window,n="keydown",s=t=>{"Escape"===t.key&&this.hide()},void e.addEventListener(n,(function t(i){s(i),e.removeEventListener(n,t)})))}},Group:class{constructor(t){const e=t.getAttribute("data-target"),n=document.querySelectorAll(e);this.prev=null,n&&(this.targets=n,this.elements=t.querySelectorAll("[data-class]"),this.init())}init(){e(this.elements,(t=>{const e=t.getAttribute("data-class");t.addEventListener("click",(t=>{this.handleClick(t,e)}))}))}handleClick(t,e){t.preventDefault();const n=this.targets,s=t.target,o=this.prev;o&&(a(n,o.previous),a(o.el,"is-active")),i(n,e),i(s,"is-active"),this.prev={previous:e,el:s}}},Dropdown:function(t){t.addEventListener("click",(e=>{const n=t.parentNode;s(n,v)?a([t,n],v):(i([t,n],v),document.addEventListener("click",(function s(i){i===e||i.target===n||n.contains(i.target)||(a([t,n],v),document.removeEventListener("click",s))})))}))}};return e({add:i,remove:a,toggle:o},((t,e)=>{h[e]=function(e){const n=e.getAttribute("data-target"),s=e.getAttribute("data-class")||"is-active",i=n?document.querySelectorAll(n):[e];i&&s&&e.addEventListener("click",(()=>{t(i,s)}))}})),e(h,((t,n)=>{const s=n.toLowerCase();e(document.querySelectorAll(`[data-wjs="${s}"]`),(e=>{new t(e)}))})),h})),function(){function t(t){return document.getElementById(t)}function e(t,e){return(e||document).querySelector(t)}function n(t){var e=t.split(":");return 60*+e[0]*60+60*+e[1]}const s={day:86400,hour:3600,minute:60,second:1},i=t=>{const e=new Intl.RelativeTimeFormat,n=(t=>(Date.now()-t)/1e3)(t),{value:i,unit:a}=(t=>{for(const[e,n]of Object.entries(s))if(t>=n||"second"===e)return{value:-1*Math.floor(t/n),unit:e}})(n);return e.format(i,a)};function a(t="America/Hermosillo"){let e=new Date,n=e.toLocaleTimeString([],{timeStyle:"short",timeZone:t}),s=e.toLocaleString("es",{weekday:"long",timeZone:t});return{date:e,time:n,week:s}}function o(t,e){let n="";for(const s of t.slice(0,e)){let t=s.played_at,e=new Date(1e3*t);n+=`\n        <div class="history-item" style="--his-bg: url(${s.song.art})">\n          <div class="history-meta">\n            <h3 class="history-title">${s.song.title}</h3>\n            <div class="history-artist">${s.song.artist}</div>\n            <span class="history-timeago">${i(e)}</span>\n          </div>\n        </div>\n      `}return n}function r(t,n){let s=e(".song-cover",t),i=e(".song-title",t),a=e(".song-artist",t),o=e(".song-album",t);s&&(s.src=n.art),i&&(i.innerText=n.title),a&&(a.innerText=n.artist),o&&(o.innerText=n.album)}const c=e(".player"),l=e(".player-audio"),d="https://stream.radioani.me/listen/japanisu/";if(l){const $=l.querySelectorAll(".player-source");let _=localStorage.getItem("radioSrc")||"radio.mp3";$.forEach((t=>{t.dataset.type==_?t.classList.add("is-active"):t.classList.remove("is-active"),t.onclick=()=>{!function(t){let e=t.dataset.type;$.forEach((t=>{t.dataset.type==e?t.classList.add("is-active"):t.classList.remove("is-active")})),_!=e&&(localStorage.setItem("radioSrc",e),h(),H.src=d+e,v()),_=e}(t)}}));const H=new Audio(d+_),I=e(".player-volume",l);I.addEventListener("change",(function(t){H.volume=t.currentTarget.value/100,localStorage.setItem("player_vol",H.volume)}),!1);var u=localStorage.getItem("player_vol");u&&(H.volume=u,I.value=100*u);var m=e(".player-toggle",l);"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){v()})),navigator.mediaSession.setActionHandler("pause",(function(){h()})));var g=null;function v(){H.load(),c.classList.add("is-playing"),H.play(),m.innerHTML='<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>',null==g&&function(t){t.crossOrigin="anonymous";const e=new AudioContext,n=e.createMediaElementSource(t),s=e.createAnalyser();n.connect(s),n.connect(e.destination);const i=new Uint8Array(s.frequencyBinCount);s.getByteFrequencyData(i);const a=document.querySelector(".visualizer");for(let t=0;t<20;t++){const e=document.createElement("DIV");e.setAttribute("id","bar"+t),e.setAttribute("class","visualizer-item"),a.appendChild(e)}!function t(){s.getByteFrequencyData(i);const e=a.dataset.fftSize;e&&(s.fftSize=e);for(let t=0;t<20;t++){const e=i[2*(t+10)],n=document.querySelector("#bar"+t);if(!n)continue;const s=Math.max(4,e||0);n.style.height=s+"px"}window.requestAnimationFrame(t)}()}(H),g="init visualizer"}function h(){c.classList.remove("is-playing"),H.pause(),m.innerHTML='<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>'}m.addEventListener("click",(()=>{H.paused?v():h()}),!1)}const y="https://stream.radioani.me/api/nowplaying_static/japanisu.json",p=t("playerHistory");!function t(){fetch(y).then((t=>t.json())).then((n=>{let s=n.song_history,i=e(".song-now",c),a=e(".song-next",c),l=n.now_playing.remaining,d=e(".posterA"),u=e(".posterB");d&&d.src&&(d.crossOrigin="Anonymous",d.src="https://images.weserv.nl/?url="+encodeURIComponent(n.now_playing.song.art),function(t,e){let n=new ColorThief;e.complete?t.setAttribute("style",`--accent: rgb(${n.getColor(e)})`):e.addEventListener("load",(function(){t.setAttribute("style",`--accent: rgb(${n.getColor(e)})`)}))}(document.body,d)),u&&u.src&&(u.crossOrigin="Anonymous",u.src="https://images.weserv.nl/?url="+encodeURIComponent(n.playing_next.song.art)),i&&r(i,n.now_playing.song),a&&r(a,n.playing_next.song);var m=S.classList.contains("is-active")?15:4;p&&(S.onclick=()=>{S.classList.remove("is-active"),E.classList.remove("has-history"),p.innerHTML=o(s,4),k.innerText="Ver más"},k.onclick=()=>{S.classList.contains("is-active")?(S.classList.remove("is-active"),E.classList.remove("has-history"),p.innerHTML=o(s,4),k.innerText="Ver más"):(S.classList.add("is-active"),E.classList.add("has-history"),p.innerHTML=o(s,15),k.innerText="Ver menos")},p.innerHTML=o(s,m)),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:n.now_playing.song.title,artist:n.now_playing.song.artist,album:n.now_playing.song.album,artwork:[{src:n.now_playing.song.art,sizes:"96x96",type:"image/png"},{src:n.now_playing.song.art,sizes:"128x128",type:"image/png"},{src:n.now_playing.song.art,sizes:"192x192",type:"image/png"},{src:n.now_playing.song.art,sizes:"256x256",type:"image/png"}]})),document.querySelectorAll(".player-meta").forEach((t=>{var n=e(".song-title",t),s=n.offsetWidth,i=t.offsetWidth;t.setAttribute("style","--title-width:"+i+"px"),s>i?n.classList.add("song-very-long"):n.classList.remove("song-very-long")})),setTimeout(t,1e3*l)})).catch((t=>console.log(t)))}();const f=t("listeners");function w(t){return`\n      <div class="upcoming bg-dark shadow-xl" data-start="${t.start}" data-end="${t.end}" data-weekday="${t.day}" >\n        <img class="upcoming-image fit-image" src="${t.poster}" alt="${t.title}">\n        <div class="upcoming-data fs-7 relative py-.75 px-1.25">\n          <div class="upcoming-title fw-500 color-title nowrap">${t.title}</div>\n          <div class="upcoming-snippet fw-500 my-1">${t.snippet}</div>\n          <div class="upcoming-time">${t.start} - ${t.end}</div>\n        </div>\n      </div>\n    `}f&&function t(){fetch(y).then((t=>t.json())).then((e=>{let n=e.listeners.current;f.innerText=n,setTimeout(t,1e3*(f.dataset.update||5))})).catch((t=>console.log(t)))}();const L=t("program"),b=t("showWeeklySchedule"),k=t("showRecentlyPlayed"),S=t("closeHistory"),E=t("blog");function A(){let t=a(),e=L.querySelectorAll(".program-program"),s=n(t.time);e.forEach((e=>{if(e.dataset.week==t.week){e.querySelectorAll(".upcoming").forEach((t=>{let e=n(t.dataset.start),i=n(t.dataset.end);e<=s&&i>s?t.classList.add("is-online"):t.classList.remove("is-online")}))}}))}function x(){L.classList.add("program","grid","l:cols-7","cols-1","is-active"),L.querySelectorAll(".program-program").forEach((t=>{let e=t.dataset.week;var n,s,i;t.innerHTML=(n=currentSchedule,s=e,i="",n.forEach((t=>{t.day==s&&(i+=w(t))})),i)})),L.classList.remove("none")}L&&b.addEventListener("click",(()=>{b.classList.contains("is-active")?(b.classList.remove("is-active"),L.classList.add("none"),L.classList.remove("program","grid","l:cols-7","cols-1","is-active"),L.querySelectorAll(".program-program").forEach((t=>{t.innerHTML=""})),clearInterval(A)):(b.classList.add("is-active"),x(),A(),setInterval(A,1e4))}),!1);const T=t("renderUpcoming");function q(){let t=a();T.querySelectorAll(".upcoming").forEach((e=>{let s=(n(e.dataset.start)-n(t.time))/16+48,i=(n(e.dataset.start)-(n(t.time)-86400))/16+48;e.setAttribute("style",`transform: translateX(${e.dataset.weekday==t.week?s:i}px)`),e.classList.add("is-loaded")}))}T&&(q(),setInterval(q,2e4)),function t(){let e=a(),s=n("24:00")-n(e.time);T&&(T.innerHTML=function(t){let e=a();var n="";let s=(i=e.week,o="","lunes"==i?o="martes":"martes"==i?o="miércoles":"miércoles"==i?o="jueves":"jueves"==i?o="viernes":"viernes"==i?o="sábado":"sábado"==i?o="domingo":"domingo"==i&&(o="lunes"),o);var i,o;return t.forEach((t=>{t.day!=e.week&&t.day!=s||(n+=w(t))})),n}(currentSchedule)),q(),setTimeout(t,1e3*(0===s?10:s))}();const C=document.querySelector(".header-player");window.innerWidth>760&&function(){if(C){var t=C.offsetHeight;window.addEventListener("scroll",(function(){window.scrollY>C.offsetTop+t?(C.nextElementSibling.setAttribute("style","margin-top:"+t+"px"),C.classList.add("header-sticky","fixed","z-100","t-0","x-0")):(C.classList.remove("header-sticky","fixed","z-100","t-0","x-0"),C.nextElementSibling.removeAttribute("style"))}))}}(),e("[data-flickity]")&&Defer.js("https://cdn.jsdelivr.net/npm/flickity@2/dist/flickity.pkgd.min.js","flickity",100,null,!0),Defer.dom(".lazyload",0,"is-loaded"),document.body.classList.remove("preload")}();