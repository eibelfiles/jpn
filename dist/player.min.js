//! Japanisu Player v9.8
!function(){function e(e,t){return(t||document).querySelector(e)}function t(t,n){let a=e(".song-cover",t),s=e(".song-title",t),i=e(".song-artist",t),o=e(".song-album",t);a&&(a.src=n.art),s&&(s.innerText=n.title),i&&(i.innerText=n.artist),o&&(o.innerText=n.album)}function n(e){e<10?o.innerHTML='<i class="fa-solid fa-volume-off"></i>':e<60&&e>10?o.innerHTML='<i class="fa-solid fa-volume-low"></i>':e>60&&(o.innerHTML='<i class="fa-solid fa-volume-high"></i>')}const a=e(".player"),s=e(".player-audio"),i=e(".player-volume-toggle"),o=e(".player-volume-toggle-btn"),l="https://stream.radioani.me/listen/japanisu/";if(s){const m=a.querySelectorAll(".player-source");let v=localStorage.getItem("radioSrc")||"radio.mp3";m.forEach((e=>{e.dataset.type==v?e.classList.add("is-active"):e.classList.remove("is-active"),e.onclick=()=>{!function(e){let t=e.dataset.type;m.forEach((e=>{e.dataset.type==t?e.classList.add("is-active"):e.classList.remove("is-active")})),v!=t&&(localStorage.setItem("radioSrc",t),p(),f.src=l+t,u()),v=t}(e)}}));const f=new Audio(l+v);i&&o&&(o.onclick=()=>{i.classList.toggle("is-active")});const h=e(".player-volume",s);h.addEventListener("change",(function(e){f.volume=e.currentTarget.value/100,i&&o&&n(e.currentTarget.value),localStorage.setItem("player_vol",f.volume)}),!1);var r=localStorage.getItem("player_vol");r&&(f.volume=r,h.value=100*r),i&&o&&n(h.value);var c=e(".player-toggle",s),g=null;function u(){f.load(),a.classList.toggle("is-playing"),f.play(),c.innerHTML='<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>',null==g&&function(e){e.crossOrigin="anonymous";const t=new AudioContext,n=t.createMediaElementSource(e),a=t.createAnalyser();n.connect(a),n.connect(t.destination);const s=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(s);const i=document.querySelector(".visualizer");for(let e=0;e<20;e++){const t=document.createElement("DIV");t.setAttribute("id","bar"+e),t.setAttribute("class","visualizer-item"),i.appendChild(t)}!function e(){a.getByteFrequencyData(s);const t=i.dataset.fftSize;t&&(a.fftSize=t);for(let e=0;e<20;e++){const t=s[2*(e+10)],n=document.querySelector("#bar"+e);if(!n)continue;const a=Math.max(4,t||0);n.style.height=a+"px"}window.requestAnimationFrame(e)}()}(f),g="init visualizer"}function p(){a.classList.toggle("is-playing"),f.pause(),c.innerHTML='<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>'}"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){u()})),navigator.mediaSession.setActionHandler("pause",(function(){p()}))),c.addEventListener("click",(()=>{f.paused?u():p()}),!1)}const d="https://stream.radioani.me/api/live/nowplaying/sse?cf_connect="+JSON.stringify({subs:{"station:japanisu":{}}});function y(n,s=!1){let i=n.song_history,o=(l="playerHistory",document.getElementById(l));var l;let r=e(".song-now",a),c=e(".song-next",a),g=e(".player-poster");g&&g.src&&(g.crossOrigin="Anonymous",g.src="https://images.weserv.nl/?url="+encodeURIComponent(n.now_playing.song.art),function(e,t){let n=new ColorThief;t.complete?e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`):t.addEventListener("load",(function(){e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`)}))}(document.body,g)),r&&t(r,n.now_playing.song),c&&t(c,n.playing_next.song),o&&(o.innerHTML=createHistory(i,o.dataset.results||5)),document.querySelectorAll(".player-meta").forEach((t=>{var n=e(".song-title",t),a=n.offsetWidth,s=t.offsetWidth;t.setAttribute("style","--title-width:"+s+"px"),a>s?n.classList.add("song-very-long"):n.classList.remove("song-very-long")})),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:n.now_playing.song.title,artist:n.now_playing.song.artist,album:n.now_playing.song.album,artwork:[{src:n.now_playing.song.art,sizes:"96x96",type:"image/png"},{src:n.now_playing.song.art,sizes:"128x128",type:"image/png"},{src:n.now_playing.song.art,sizes:"192x192",type:"image/png"},{src:n.now_playing.song.art,sizes:"256x256",type:"image/png"}]}))}document.querySelector("[data-sse]")?new EventSource(d).onmessage=e=>{const t=JSON.parse(e.data)?.pub?.data?.np||null;t&&y(t,!1)}:function e(){fetch("https://stream.radioani.me/api/nowplaying_static/japanisu.json").then((e=>e.json())).then((t=>{y(t,!0);let n=t.now_playing.remaining;setTimeout(e,1e3*(n+1))})).catch((e=>console.log(e)))}()}();