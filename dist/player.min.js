//! Japanisu Player v10.0.1
!function(){function e(e,t){return(t||document).querySelector(e)}function t(e,t){if(!e||!t)return;const n=t.querySelector(".set-artist"),a=t.querySelector(".set-title"),o=t.querySelector(".set-album"),s=t.querySelector(".set-art"),i=t.querySelector(".set-year"),r=t.querySelector(".set-duration"),l=t.querySelector(".set-cover");l&&(l.src=e.song.art),n&&(n.innerText=e.song.artist),a&&(a.innerText=e.song.title),o&&(o.innerText=e.song.album),s&&(s.src=e.song.art),i&&(i.innerText=e.song.custom_fields.year),r&&(r.innerText=function(e){const t=e%60;function n(e){return e.toString().padStart(2,"0")}return`${n(Math.floor(e/60))}:${n(t)}`}(e.duration))}function n(e){e<10?i.innerHTML='<i class="fa-solid fa-volume-off"></i>':e<60&&e>10?i.innerHTML='<i class="fa-solid fa-volume-low"></i>':e>60&&(i.innerHTML='<i class="fa-solid fa-volume-high"></i>')}const a=e(".player"),o=e(".player-audio"),s=e(".player-volume-toggle"),i=e(".player-volume-toggle-btn"),r="https://stream.radioani.me/listen/japanisu/";if(o){const m=a.querySelectorAll(".player-source");let v=localStorage.getItem("radioSrc")||"radio.mp3";m.forEach((e=>{e.dataset.type==v?e.classList.add("is-active"):e.classList.remove("is-active"),e.onclick=()=>{!function(e){let t=e.dataset.type;m.forEach((e=>{e.dataset.type==t?e.classList.add("is-active"):e.classList.remove("is-active")})),v!=t&&(localStorage.setItem("radioSrc",t),y(),f.src=r+t,g()),v=t}(e)}}));const f=new Audio(r+v);s&&i&&(i.onclick=()=>{s.classList.toggle("is-active")});const S=e(".player-volume",o);S.addEventListener("change",(function(e){f.volume=e.currentTarget.value/100,s&&i&&n(e.currentTarget.value),localStorage.setItem("player_vol",f.volume)}),!1);var l=localStorage.getItem("player_vol");l&&(f.volume=l,S.value=100*l),s&&i&&n(S.value);var c=e(".player-toggle",o),u=null;function g(){f.load(),a.classList.toggle("is-playing"),f.play(),c.innerHTML='<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>',null==u&&function(e){e.crossOrigin="anonymous";const t=new AudioContext,n=t.createMediaElementSource(e),a=t.createAnalyser();n.connect(a),n.connect(t.destination);const o=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(o);const s=document.querySelector(".visualizer");for(let e=0;e<20;e++){const t=document.createElement("DIV");t.setAttribute("id","bar"+e),t.setAttribute("class","visualizer-item"),s.appendChild(t)}!function e(){a.getByteFrequencyData(o);const t=s.dataset.fftSize;t&&(a.fftSize=t);for(let e=0;e<20;e++){const t=o[2*(e+10)],n=document.querySelector("#bar"+e);if(!n)continue;const a=Math.max(4,t||0);n.style.height=a+"px"}window.requestAnimationFrame(e)}()}(f),u="init visualizer"}function y(){a.classList.toggle("is-playing"),f.pause(),c.innerHTML='<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>'}"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){g()})),navigator.mediaSession.setActionHandler("pause",(function(){y()}))),c.addEventListener("click",(()=>{f.paused?g():y()}),!1)}const d="https://stream.radioani.me/api/live/nowplaying/sse?cf_connect="+JSON.stringify({subs:{"station:japanisu":{}}});function p(n,o=!1){let s=n.song_history,i=(r="playerHistory",document.getElementById(r));var r;let l=e(".song-now",a),c=e(".song-next",a),u=e(".player-poster");u&&u.src&&(u.crossOrigin="Anonymous",u.src="https://images.weserv.nl/?url="+encodeURIComponent(n.now_playing.song.art),function(e,t){let n=new ColorThief;t.complete?e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`):t.addEventListener("load",(function(){e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`)}))}(document.body,u)),l&&t(n.now_playing,l),c&&t(n.playing_next,c),i&&(i.innerHTML=createHistory(s,i.dataset.results||5)),document.querySelectorAll(".player-meta").forEach((t=>{var n=e(".song-title",t),a=n.offsetWidth,o=t.offsetWidth;t.setAttribute("style","--title-width:"+o+"px"),a>o?n.classList.add("song-very-long"):n.classList.remove("song-very-long")})),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:n.now_playing.song.title,artist:n.now_playing.song.artist,album:n.now_playing.song.album,artwork:[{src:n.now_playing.song.art,sizes:"96x96",type:"image/png"},{src:n.now_playing.song.art,sizes:"128x128",type:"image/png"},{src:n.now_playing.song.art,sizes:"192x192",type:"image/png"},{src:n.now_playing.song.art,sizes:"256x256",type:"image/png"}]}))}document.querySelector("[data-sse]")?new EventSource(d).onmessage=e=>{const t=JSON.parse(e.data)?.pub?.data?.np||null;t&&p(t,!1)}:function e(){fetch("https://stream.radioani.me/api/nowplaying_static/japanisu.json").then((e=>e.json())).then((t=>{p(t,!0);let n=t.now_playing.remaining;setTimeout(e,1e3*(n+1))})).catch((e=>console.log(e)))}()}();