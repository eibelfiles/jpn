//! Japanisu Player v9.1
!function(){function e(e,t){return(t||document).querySelector(e)}function t(t,n){let a=e(".song-cover",t),o=e(".song-title",t),i=e(".song-artist",t),s=e(".song-album",t);a&&(a.src=n.art),o&&(o.innerText=n.title),i&&(i.innerText=n.artist),s&&(s.innerText=n.album)}function n(e){e<10?s.innerHTML='<i class="fa-solid fa-volume-off"></i>':e<60&&e>10?s.innerHTML='<i class="fa-solid fa-volume-low"></i>':e>60&&(s.innerHTML='<i class="fa-solid fa-volume-high"></i>')}const a=e(".player"),o=e(".player-audio"),i=e(".player-volume-toggle"),s=e(".player-volume-toggle-btn");if(o&&o.dataset.src){const y=new Audio(o.dataset.src);i&&s&&(s.onclick=()=>{i.classList.toggle("is-active")});const p=e(".player-volume",o);p.addEventListener("change",(function(e){y.volume=e.currentTarget.value/100,i&&s&&n(e.currentTarget.value),localStorage.setItem("player_vol",y.volume)}),!1);var l=localStorage.getItem("player_vol");l&&(y.volume=l,p.value=100*l),i&&s&&n(p.value);var r=e(".player-toggle",o),c=null;function g(){y.load(),a.classList.toggle("is-playing"),y.play(),r.innerHTML='<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>',null==c&&function(e){e.crossOrigin="anonymous";const t=new AudioContext,n=t.createMediaElementSource(e),a=t.createAnalyser();n.connect(a),n.connect(t.destination);const o=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(o);const i=document.querySelector(".visualizer");for(let e=0;e<20;e++){const t=document.createElement("DIV");t.setAttribute("id","bar"+e),t.setAttribute("class","visualizer-item"),i.appendChild(t)}!function e(){a.getByteFrequencyData(o);for(let e=0;e<20;e++){const t=o[2*(e+10)],n=document.querySelector("#bar"+e);if(!n)continue;const a=Math.max(4,t||0);n.style.height=a+"px"}window.requestAnimationFrame(e)}()}(y),c="init visualizer"}function u(){a.classList.toggle("is-playing"),y.pause(),r.innerHTML='<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>'}"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){g()})),navigator.mediaSession.setActionHandler("pause",(function(){u()}))),r.addEventListener("click",(()=>{y.paused?g():u()}),!1)}!function n(){fetch("https://stream.radioani.me/api/nowplaying_static/japanisu.json").then((e=>e.json())).then((o=>{let i=o.song_history,s=(l="playerHistory",document.getElementById(l));var l;let r=e(".song-now",a),c=e(".song-next",a),g=o.now_playing.remaining,u=e(".player-poster");u&&u.src&&(u.crossOrigin="Anonymous",u.src="https://images.weserv.nl/?url="+encodeURIComponent(o.now_playing.song.art),function(e,t){let n=new ColorThief;t.complete?e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`):t.addEventListener("load",(function(){e.setAttribute("style",`--accent: rgb(${n.getColor(t)})`)}))}(document.body,u)),r&&t(r,o.now_playing.song),c&&t(c,o.playing_next.song),s&&(s.innerHTML=createHistory(i,s.dataset.results||5)),document.querySelectorAll(".player-meta").forEach((t=>{var n=e(".song-title",t),a=n.offsetWidth,o=t.offsetWidth;t.setAttribute("style","--title-width:"+o+"px"),a>o?n.classList.add("song-very-long"):n.classList.remove("song-very-long")})),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:o.now_playing.song.title,artist:o.now_playing.song.artist,album:o.now_playing.song.album,artwork:[{src:o.now_playing.song.art,sizes:"96x96",type:"image/png"},{src:o.now_playing.song.art,sizes:"128x128",type:"image/png"},{src:o.now_playing.song.art,sizes:"192x192",type:"image/png"},{src:o.now_playing.song.art,sizes:"256x256",type:"image/png"}]})),setTimeout(n,1e3*g)})).catch((e=>console.log(e)))}()}();